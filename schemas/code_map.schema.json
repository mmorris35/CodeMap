{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "CodeMap Schema",
  "description": "Code dependency and symbol map for Python projects",
  "type": "object",
  "required": [
    "version",
    "generated_at",
    "source_root",
    "symbols",
    "dependencies"
  ],
  "properties": {
    "schema": {
      "type": "string",
      "description": "URL of this JSON schema"
    },
    "version": {
      "type": "string",
      "description": "Schema version (e.g., 1.0)",
      "pattern": "^\\d+\\.\\d+$"
    },
    "generated_at": {
      "type": "string",
      "description": "ISO 8601 timestamp of generation",
      "format": "date-time"
    },
    "source_root": {
      "type": "string",
      "description": "Root directory of analyzed source code"
    },
    "symbols": {
      "type": "array",
      "description": "All symbols found in the codebase",
      "items": {
        "type": "object",
        "required": [
          "qualified_name",
          "kind",
          "file",
          "line"
        ],
        "properties": {
          "qualified_name": {
            "type": "string",
            "description": "Fully qualified symbol name (e.g., module.class.method)"
          },
          "kind": {
            "type": "string",
            "enum": [
              "module",
              "class",
              "function",
              "method"
            ],
            "description": "Type of symbol"
          },
          "file": {
            "type": "string",
            "description": "Path to file containing symbol"
          },
          "line": {
            "type": "integer",
            "description": "Line number of symbol definition"
          },
          "column": {
            "type": "integer",
            "description": "Column number of symbol definition"
          },
          "docstring": {
            "type": "string",
            "description": "Docstring for the symbol"
          },
          "signature": {
            "type": "string",
            "description": "Function/method signature"
          },
          "task_links": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "Task IDs from DEVELOPMENT_PLAN this symbol implements"
          }
        }
      }
    },
    "dependencies": {
      "type": "array",
      "description": "All detected dependencies between symbols",
      "items": {
        "type": "object",
        "required": [
          "from_sym",
          "to_sym"
        ],
        "properties": {
          "from_sym": {
            "type": "string",
            "description": "Source symbol qualified name"
          },
          "to_sym": {
            "type": "string",
            "description": "Target symbol qualified name"
          },
          "kind": {
            "type": "string",
            "enum": [
              "calls",
              "imports",
              "inherits"
            ],
            "description": "Type of dependency"
          },
          "locations": {
            "type": "array",
            "description": "Where this dependency occurs in source",
            "items": {
              "type": "object",
              "properties": {
                "file": {
                  "type": "string"
                },
                "line": {
                  "type": "integer"
                }
              }
            }
          }
        }
      }
    }
  }
}
